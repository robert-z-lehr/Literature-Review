<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shade Structures – Literature Review</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Marked: Markdown -> HTML -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    :root {
      /* Warm burnt-orange inspired (not UT exact) */
      --bg: #FFF7F1;        /* page background: light warm */
      --fg: #2A1E1A;        /* main text: deep brown */
      --muted: #6E5247;     /* secondary text */
      --accent: #9B5330;    /* headings/emphasis */
      --tab: #FCE6D9;       /* inactive tabs */
      --tab-active: #F8D7C2;/* active tab */
      --border: #EAC7B4;    /* borders */
      --link: #8A3E22;      /* links */
      --maxw: 1050px;

      --btn-bg: #EFC8B2;
      --btn-bg-hover: #E7B79B;
      --btn-border: #D9A88C;
      --input-bg: #FFFDFC;
      --input-border: #E6CABB;
      --input-placeholder: #9D7F73;
      --ok: #1b7f4b;
      --err: #8a2f1d;
    }

    html, body {
      margin: 0; padding: 0; background: var(--bg); color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height: 1.55;
    }
    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .wrap {
      max-width: var(--maxw);
      margin: 28px auto 48px auto;
      padding: 0 16px;
    }

    header h1 {
      font-size: clamp(1.4rem, 2.2vw, 2rem);
      margin: 0 0 4px 0;
      letter-spacing: .2px;
      color: var(--accent);
    }
    header p { margin: 4px 0 8px 0; color: var(--muted); }

    /* Top row: repo link + feedback form aligned */
    .header-row {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-top: 6px;
      margin-bottom: 14px;
    }
    .repo-link {
      font-size: 0.9rem;
      flex: 0 0 auto;
    }

    /* Feedback mini-form */
    .feedback {
      display: flex;
      gap: 8px;
      align-items: center;
      flex: 1 1 480px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    .feedback input[type="text"],
    .feedback input[type="email"]{
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 0.95rem;
      color: var(--fg);
      outline: none;
      min-width: 260px;
    }
    .feedback input[type="text"]::placeholder{
      color: var(--input-placeholder);
    }
    .feedback input[type="email"]{
      min-width: 200px;
    }
    .feedback .feedback-btn{
      background: var(--btn-bg);
      border: 1px solid var(--btn-border);
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 0.95rem;
      cursor: pointer;
      user-select: none;
    }
    .feedback .feedback-btn:hover{
      background: var(--btn-bg-hover);
    }
    .feedback .status{
      font-size: 0.9rem;
      min-height: 1.2em;
    }
    .status.ok { color: var(--ok); }
    .status.err{ color: var(--err); }

    /* Tabs */
    .tabs {
      display: flex; gap: 6px; flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
      padding-bottom: 6px; margin-bottom: 18px;
    }
    .tab {
      display: inline-flex; align-items: center;
      padding: 8px 12px; border: 1px solid var(--border);
      border-bottom: none;
      background: var(--tab);
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      cursor: pointer; user-select: none;
      font-size: 0.95rem;
    }
    .tab[aria-selected="true"] { background: var(--tab-active); font-weight: 600; }

    .panel {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      min-height: 200px;
      background: transparent;
    }
    .loading, .error {
      padding: 12px 0; color: var(--muted);
      font-family: ui-monospace, Menlo, Consolas, monospace;
      font-size: 0.95rem; white-space: pre-wrap;
    }

    /* Rendered Markdown tweaks */
    .panel :is(h1,h2,h3) { margin-top: 1.25em; color: var(--accent); }
    .panel h1 { font-size: 1.5rem; }
    .panel h2 { font-size: 1.25rem; }
    .panel h3 { font-size: 1.05rem; }
    .panel code { background: rgba(125,125,125,.12); padding: 0 .25em; border-radius: 4px; }
    .panel pre { overflow-x: auto; padding: 12px; border: 1px solid var(--border); border-radius: 8px; }
    .panel table { border-collapse: collapse; width: 100%; }
    .panel th, .panel td { border: 1px solid var(--border); padding: 8px; text-align: left; }
    .panel blockquote { border-left: 3px solid var(--border); padding-left: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Stoplight-Mounted Shade Structures — Literature & Precedents</h1>
      <p>Tabs: integrative narrative and individual source reviews. Click a tab to load the corresponding Markdown file from this repository.</p>

      <div class="header-row">
        <p class="repo-link">
          <a href="https://github.com/robert-z-lehr/Literature-Review/tree/main" target="_blank" rel="noopener">View on GitHub Repository</a>
        </p>

        <!-- Feedback mini-form -->
        <form class="feedback" id="feedbackForm" action="#" method="POST" novalidate>
          <input
            type="text"
            id="fbMessage"
            name="message"
            placeholder="write feedback, questions, or suggestions here!"
            aria-label="Feedback message"
            required
          />
          <input
            type="email"
            id="fbEmail"
            name="email"
            placeholder="optional email if you want a reply"
            aria-label="Your email (optional)"
          />
          <button type="button" id="fbBtn" class="feedback-btn" aria-label="Send feedback"
            data-label-default="Feedback" data-label-hover="Send">Feedback</button>
          <span class="status" id="fbStatus" aria-live="polite"></span>

          <!-- Honeypot (spam trap) -->
          <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off" />
        </form>
      </div>
    </header>

    <!-- TAB BAR -->
    <nav class="tabs" id="tabs" role="tablist" aria-label="Literature review tabs"></nav>

    <!-- CONTENT PANEL -->
    <section class="panel" id="panel" role="tabpanel" tabindex="0" aria-live="polite">
      <div class="loading">Loading…</div>
    </section>
  </div>

  <script>
    // ---- Tabs configuration ----
    const TABS = [
      { label: "Integrative Narrative", path: "drafts/integrative-literature-review.md" },
      { label: "Thermal Exposure — Key Sources", path: "sources/Thermal_Exposure_Key_Sources.md" },
      { label: "Equity & Accessibility", path: "sources/Equity_Accessibility.md" },
      { label: "Behavioral Responses", path: "sources/Behavioral_Responses.md" },
      { label: "Feasibility & Precedents", path: "sources/Feasibility_Precedents.md" },
      { label: "Niyogi 2019 (Austin Heat Mapping)", path: "sources/Niyogi_2019_AustinHeatMapping.md" }
    ];

    // Repo base path (works on GH Pages under /<repo>/)
    const basePath = (() => {
      const parts = window.location.pathname.split("/").filter(Boolean);
      if (parts.length >= 1) return "/" + parts[0] + "/";
      return "/";
    })();

    const tabsEl = document.getElementById("tabs");
    const panelEl = document.getElementById("panel");

    function renderTabs() {
      tabsEl.innerHTML = "";
      TABS.forEach((t, idx) => {
        const btn = document.createElement("button");
        btn.className = "tab";
        btn.type = "button";
        btn.setAttribute("role", "tab");
        btn.setAttribute("aria-selected", idx === 0 ? "true" : "false");
        btn.setAttribute("aria-controls", "panel");
        btn.id = "tab-" + idx;
        btn.textContent = t.label;
        btn.addEventListener("click", () => activateTab(idx));
        tabsEl.appendChild(btn);
      });
    }

    async function fetchMarkdown(path) {
      const url = basePath + path;
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status} — ${url}`);
      return res.text();
    }

    async function activateTab(idx) {
      [...tabsEl.children].forEach((el, i) => {
        el.setAttribute("aria-selected", i === idx ? "true" : "false");
      });
      panelEl.innerHTML = '<div class="loading">Loading…</div>';
      const mdPath = TABS[idx].path;

      try {
        const md = await fetchMarkdown(mdPath);
        panelEl.innerHTML = marked.parse(md);
        panelEl.focus({ preventScroll: true });
      } catch (err) {
        panelEl.innerHTML = `<div class="error">Could not load: ${mdPath}\n${err.message}</div>`;
      }
    }

    // ---- Feedback form logic (Formspree example) ----
    // Where the email is "sent from": Formspree receives the POST and forwards to your configured inbox.
    // Replace with your endpoint: https://formspree.io/f/YOUR_FORM_ID
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/YOUR_FORM_ID";

    const fbForm   = document.getElementById("feedbackForm");
    const fbMsg    = document.getElementById("fbMessage");
    const fbEmail  = document.getElementById("fbEmail");
    const fbBtn    = document.getElementById("fbBtn");
    const fbStatus = document.getElementById("fbStatus");

    // Hover: swap label "Feedback" <-> "Send"
    fbBtn.addEventListener("mouseenter", () => {
      fbBtn.textContent = fbBtn.dataset.labelHover || "Send";
    });
    fbBtn.addEventListener("mouseleave", () => {
      fbBtn.textContent = fbBtn.dataset.labelDefault || "Feedback";
    });

    // Submit on click
    fbBtn.addEventListener("click", submitFeedback);

    // Submit on Enter when message input focused
    fbMsg.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        submitFeedback();
      }
    });

    function setStatus(msg, ok = false) {
      fbStatus.textContent = msg;
      fbStatus.className = "status " + (ok ? "ok" : "err");
    }

    async function submitFeedback() {
      const message = (fbMsg.value || "").trim();
      const email   = (fbEmail.value || "").trim();

      if (!message) {
        setStatus("Please enter a message before sending.", false);
        fbMsg.focus();
        return;
      }

      setStatus("Sending…", true);

      try {
        // Honeypot check
        const honeypot = [...fbForm.elements].find(el => el.name === "_gotcha");
        if (honeypot && honeypot.value) return; // silently drop bots

        const payload = {
          message,
          email: email || undefined,
          page: location.href,
          ua: navigator.userAgent
        };

        const res = await fetch(FORMSPREE_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json", "Accept": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const txt = await res.text();
          throw new Error(`HTTP ${res.status} ${txt}`.slice(0, 240));
        }

        fbMsg.value = "";
        // keep optional email as-is so they can send multiple messages
        setStatus("Thank you — feedback sent.", true);
      } catch (err) {
        setStatus("Could not send. Please try again or email directly.", false);
        console.error(err);
      }
    }

    // Init
    renderTabs();
    activateTab(0);
  </script>
</body>
</html>
